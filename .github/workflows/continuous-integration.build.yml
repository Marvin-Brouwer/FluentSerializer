name: "Continuous integration - Build"
on:
  workflow_call:

jobs:
  build:
    name: "Build ${{ matrix.version.framework }}"
    runs-on: ubuntu-latest
    strategy:
      fail-fast: true
      matrix:
        version: [
          {tag: "7.0.x", framework: "net7.0"},
          {tag: "6.0.x", framework: "net6.0"},
          {tag: "3.1.x", framework: "netstandard2.1"}
        ]
    steps:
    ###
    # Checkout repository
    ###
    - name: Checkout repository
      uses: actions/checkout@v3
      with:
        lfs: true
    ###
    # ðŸ§° Install .Net SDKs
    #
    # Configure the pipeline to use the correct .Net sdk versions
    ###
    - name: ðŸ§° Install .Net SDKs
      uses: actions/setup-dotnet@v3
      with:
        dotnet-version: ${{ matrix.version.tag }}
    ###
    # ðŸ›  Build
    ###
    - name: ðŸ›  Build
      run: |-
        dotnet build --nologo --configuration "Release"
    ###
    # ðŸ—ƒ Publish 'library-binaries-${{ matrix.version }}' artifacts
    ###
    - name: ðŸ—ƒ Publish 'library-binaries-${{ matrix.version.tag }}' artifacts
      if: ${{ always() }}
      uses: actions/upload-artifact@v3
      with:
        name: library-binaries-${{ matrix.version.tag }}
        path: |
          ./src/**/bin/Release/${{ matrix.version.framework }}/*.*
          !./src/*.Tests
          !./src/*.TestUtils
          !./src/*.Usecase.*
          !./src/*.Benchmark
          !./src/*.BenchmarkUtils
        retention-days: 20